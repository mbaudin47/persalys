
ROOT_SALOME_MECA=~/projects/salome_meca
ROOT_SALOME=${ROOT_SALOME_MECA}/V2015_1
PREREQUISITES_ROOT_DIR=${PREREQUISITES_ROOT_DIR}
~/Téléchargements/SALOME-MECA-2015.1-LGPL.run -t ${ROOT_SALOME_MECA} -l "en"

# remove lines that set LD_LIBRARY_PATH to /usr/lib/atlas-base/atlas to use provided lapack
sed -e '/atlas-base/s/^/#/g' -i ${ROOT_SALOME_MECA}/appli_V2015_1/env.d/envProducts.cfg ${ROOT_SALOME}/salome_context.cfg
vim ${ROOT_SALOME}/salome_prerequisites.sh ${ROOT_SALOME_MECA}/appli_V2015_1/env.d/envProducts.sh



source ${ROOT_SALOME_MECA}/appli_V2015_1/env.d/envProducts.sh
cd ${ROOT_SALOME}
tar xzf ~/Téléchargements/KERNEL_GUI_YACS.tar.gz

cd ${ROOT_SALOME}/KERNEL
mkdir -p build && cd build
cmake -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_INSTALL_PREFIX=${ROOT_SALOME}/modules/KERNEL_V7_5_1/ \
  -DHDF5_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Hdf5_1810/ \
  -DBOOST_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Boost_1520/ \
  -DOMNIORB_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Omniorb_416/ \
  -DOMNIORBPY_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Omniorbpy_36/ \
  -DDOXYGEN_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Doxygen_1831/ \
  -DGRAPHVIZ_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Graphviz_2380/ \
  -DLIBXML2_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Libxml2_290/ \
  -DSWIG_DIR=${PREREQUISITES_ROOT_DIR}/Swig_208/bin/ \
  -DCPPUNIT_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Cppunit_1121/ \
  -DSWIG_EXECUTABLE=${PREREQUISITES_ROOT_DIR}/Swig_208/bin/swig \
  ..
make install
# missing file ?
cp ${ROOT_SALOME}/modules/KERNEL_V7_5_1/lib/python2.7/site-packages/salome/SALOME_SDS_idl.py ${ROOT_SALOME_MECA}/appli_V2015_1/lib/python2.7/site-packages/salome/

cd ${ROOT_SALOME}/GUI
mkdir -p build && cd build
cmake -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_INSTALL_PREFIX=${ROOT_SALOME}/modules/GUI_V7_5_1/ \
  -DKERNEL_ROOT_DIR=${ROOT_SALOME}/modules/KERNEL_V7_5_1/ \
  -DHDF5_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Hdf5_1810/ \
  -DCAS_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Occ_680p1 \
  -DPYQT4_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Pyqt_496 \
  -DPARAVIEW_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Paraview_420p10/ \
  -DBOOST_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Boost_1520/ \
  -DCPPUNIT_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Cppunit_1121/ \
  -DSALOME_USE_VTKVIEWER=OFF -DSALOME_USE_PVVIEWER=OFF \
  -DQWT_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Qwt_610/ \
  -DQWT_INCLUDE_DIR=${PREREQUISITES_ROOT_DIR}/Qwt_610/include/ \
  -DQWT_LIBRARY=${PREREQUISITES_ROOT_DIR}/Qwt_610/lib/ \
  -DQT4_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Qt_484/ \
  -DSALOME_USE_PLOT2DVIEWER=OFF \
  -DSWIG_EXECUTABLE=${PREREQUISITES_ROOT_DIR}/Swig_208/bin/swig \
  ..
make install

cd ${ROOT_SALOME}/YACS
mkdir -p build && cd build
cmake -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_INSTALL_PREFIX=${ROOT_SALOME}/modules/YACS_V7_5_1/ \
  -DKERNEL_ROOT_DIR=${ROOT_SALOME}/modules/KERNEL_V7_5_1/ \
  -DGUI_ROOT_DIR=${ROOT_SALOME}/modules/GUI_V7_5_1 \
  -DSWIG_DIR=${PREREQUISITES_ROOT_DIR}/Swig_208 \
  -DSWIG_EXECUTABLE=${PREREQUISITES_ROOT_DIR}/Swig_208/bin/swig \
  -DSWIG_ROOT_DIR=${PREREQUISITES_ROOT_DIR}/Swig_208/ \
  -DSALOME_CMAKE_DEBUG=ON \
  ..
make install

# openturns
mkdir -p build && cd build
rm -f CMakeCache.txt
cmake -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_INSTALL_PREFIX=$PWD/install \
  -DLIBXML2_INCLUDE_DIR=${PREREQUISITES_ROOT_DIR}/Libxml2_290/include/libxml2 \
  -DLIBXML2_LIBRARIES=${PREREQUISITES_ROOT_DIR}/Libxml2_290/lib/libxml2.so \
  -DLAPACK_LIBRARIES="${PREREQUISITES_ROOT_DIR}/Lapack_350/lib/liblapack.so;${PREREQUISITES_ROOT_DIR}/Lapack_350/lib/libblas.so" \
  -DBOOST_ROOT=${PREREQUISITES_ROOT_DIR}/Boost_1520/ \
  -DTBB_INCLUDE_DIR=${PREREQUISITES_ROOT_DIR}/Tbb_30/include \
  -DTBB_LIBRARY=${PREREQUISITES_ROOT_DIR}/Tbb_30/lib/libtbb.so \
  -DPYTHON_INCLUDE_DIR=${PREREQUISITES_ROOT_DIR}/Python_273/include/python2.7 \
  -DPYTHON_LIBRARY=${PREREQUISITES_ROOT_DIR}/Python_273/lib/libpython2.7.so \
  -DSWIG_DIR=${PREREQUISITES_ROOT_DIR}/Swig_208 \
  -DSWIG_EXECUTABLE=${PREREQUISITES_ROOT_DIR}/Swig_208/bin/swig \
  -DUSE_TBB=OFF \
  -DUSE_HMAT=OFF \
  ..
make install

# otgui
mkdir -p build && cd build
rm -f CMakeCache.txt
cmake -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_INSTALL_PREFIX=$PWD/install \
  -DOpenTURNS_DIR=~/projects/openturns/schueller/build_salome/install/lib/cmake/openturns/ \
  -DSalomeKERNEL_DIR=${ROOT_SALOME}/modules/KERNEL_V7_5_1/salome_adm/cmake_files/ \
  -DSalomeGUI_DIR=${ROOT_SALOME}/modules/GUI_V7_5_1/adm_local/cmake_files/ \
  -DSalomeYACS_DIR=${ROOT_SALOME}/modules/YACS_V7_5_1/adm/cmake/ \
  -DPYTHON_INCLUDE_DIR=${PREREQUISITES_ROOT_DIR}/Python_273/include/python2.7 \
  -DPYTHON_LIBRARY=${PREREQUISITES_ROOT_DIR}/Python_273/lib/libpython2.7.so \
  -DSWIG_DIR=${PREREQUISITES_ROOT_DIR}/Swig_208 \
  -DSWIG_EXECUTABLE=${PREREQUISITES_ROOT_DIR}/Swig_208/bin/swig \
  -DQWT_INCLUDE_DIR=${PREREQUISITES_ROOT_DIR}/Qwt_610/include \
  -DQWT_LIBRARY=${PREREQUISITES_ROOT_DIR}/Qwt_610/lib/libqwt.so \
  ..
make install

# run gui
./gui_launch.sh

# run yacs_eval
source ${ROOT_SALOME}/salome_modules.sh
${ROOT_SALOME_MECA}/appli_V2015_1/salome shell
cd ~/projects/ot-edf/otgui/build
make t_yacs_eval_analytical
./lib/test/t_yacs_eval_analytical ../python/test/analytical.xml
PYTHONPATH=$PYTHONPATH:${ROOT_SALOME}/modules/YACS_V7_5_1/lib/python2.7/site-packages/salome
python ../python/test/t_yacs_eval_analytical.py ../python/test/analytical.xml
#python ../python/test/t_yacs_eval_jauge.py ../python/test/jauge.xml

# run gui
export OMNIORB_CONFIG=$HOME/.omniORB.cfg
./gui_launch.sh

# jauge ?
cd ${ROOT_SALOME}
tar xzf ~/Téléchargements/Calcul_Aster_OT.tgz
#sed -i "s|/home/E50954|${ROOT_SALOME}|g" ${ROOT_SALOME}/Calcul_Aster_OT/OT/Schema.xml
#sed -i "s|V6_5|V7_5_1|g" ${ROOT_SALOME}/Calcul_Aster_OT/OT/Schema.{xml,comm}
#sed -i "s|/home/E50954|${ROOT_SALOME}|g" ${ROOT_SALOME}/Calcul_Aster_OT/Calcul_Aster_OT.hdf

# astk: add comm+mmed+rmed+resu+mess+export, aster=11.7


# gdb
cd ${ROOT_SALOME}
wget -c http://ftp.gnu.org/gnu/gdb/gdb-7.10.tar.gz
tar xzf gdb-7.10.tar.gz
cd gdb-7.10
mkdir -p build && cd build
../configure --prefix=${PREREQUISITES_ROOT_DIR}/Gdb_710 --without-python --disable-nls
make
make install 
