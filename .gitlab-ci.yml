linux:
  script:
    - if test -d /tmp/ot-linux-install; then cp -r /tmp/ot-linux-install .; else ./utils/build_ot.sh && cp -r ./ot-linux-install /tmp/ot-linux-install; fi
    - if test -d /tmp/pv-linux-install; then cp -r /tmp/pv-linux-install .; else ./utils/build_pv.sh && cp -r ./pv-linux-install /tmp/pv-linux-install; fi
    - cmake -DCMAKE_INSTALL_PREFIX=$PWD/install -DCMAKE_CXX_FLAGS="-Wall"
        -DPYTHON_INCLUDE_DIR=/usr/include/python2.7 -DPYTHON_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython2.7.so
        -DOpenTURNS_DIR=$PWD/ot-linux-install/lib/cmake/openturns -DUSE_SALOME=OFF -DQWT_LIBRARY=/usr/lib/libqwt-qt5.so
        -DParaView_DIR=$PWD/pv-linux-install/lib/cmake/paraview
        -DUSE_COTIRE=ON -DCOTIRE_MAXIMUM_NUMBER_OF_UNITY_INCLUDES="-j8" .
    - make install -j8
    - make tests -j8
    - xvfb-run ctest --output-on-failure --timeout 100
  except:
    - master
    - tags

mingw:
  script:
    - git clone https://github.com/openturns/openturns.git
    - pushd openturns
    - git checkout 1.10
    - pushd distro/windows
    - tar xzf /usr/share/openturns-developers-windeps-1.8.tar.gz
    - pushd openturns-developers-windeps
    - rm -r mingw-w64-x86_64
    - tar xzf /usr/share/mingw-w64-x86_64.tar.gz
    - popd
    - if test -d /tmp/ot-mingw-install; then mkdir -p ../../build-i686-w64-mingw32 && cp -r /tmp/ot-mingw-install ../../build-i686-w64-mingw32/install; else make ot-install JOBS=4 && cp -r ../../build-i686-w64-mingw32/install /tmp/ot-mingw-install; fi
    - popd
    - popd
    - pushd distro/windows
    - make OT_PREFIX=$PWD/../../openturns/build-i686-w64-mingw32/install JOBS=8
  except:
    - master
    - tags

mingw-qt4:
  script:
    - git clone https://github.com/openturns/openturns.git
    - pushd openturns
    - git checkout 1.10
    - pushd distro/windows
    - tar xzf /usr/share/openturns-developers-windeps-1.8.tar.gz
    - pushd openturns-developers-windeps
    - rm -r mingw-w64-x86_64
    - tar xzf /usr/share/mingw-w64-x86_64.tar.gz
    - popd
    - if test -d /tmp/ot-mingw-install; then mkdir -p ../../build-i686-w64-mingw32 && cp -r /tmp/ot-mingw-install ../../build-i686-w64-mingw32/install; else make ot-install JOBS=4 && cp -r ../../build-i686-w64-mingw32/install /tmp/ot-mingw-install; fi
    - popd
    - popd
    - pushd distro/windows
    - make OT_PREFIX=$PWD/../../openturns/build-i686-w64-mingw32/install JOBS=8 USE_QT5=OFF
  except:
    - master
    - tags

mingw-tag:
  script:
    - git clone https://github.com/openturns/openturns.git
    - pushd openturns
    - git checkout 1.10
    - pushd distro/windows
    - tar xzf /usr/share/openturns-developers-windeps-1.8.tar.gz
    - pushd openturns-developers-windeps
    - rm -r mingw-w64-x86_64
    - tar xzf /usr/share/mingw-w64-x86_64.tar.gz
    - popd
    - make ot-install JOBS=4
    - popd
    - popd
    - pushd distro/windows
    - make OT_PREFIX=$PWD/../../openturns/build-i686-w64-mingw32/install JOBS=8
  artifacts:
    paths:
    - distro/windows/otgui*.exe
  only:
    - tags
